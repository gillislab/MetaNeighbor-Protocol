These scripts were used to generate the datasets used in the MetaNeighbor protocol "Scaling up reproducible research for single cell transcriptomics using MetaNeighbor". If you wish to regenerate the datasets, run the scripts as indicated below (expected run time ~ 1 hour). Alternatively, we stored the datasets [here](https://doi.org/doi:10.6084/m9.figshare.13020569.v2) for direct download.

## Regenerate datasets for the MetaNeighbor protocol

To run the R scripts, clone or download the scripts onto your computer, then navigate to the directory containing the scripts in command line and run:

```
    Rscript <scipt_name.R>
```

Alternatively, you can source the scripts (`source("<script_name.R")`) in an interactive R session or Rstudio.

We suggest to run the scripts in the following order:

 - install_dependencies.R: this script will install all necessary packages for the other scripts to run.
 - download_biccn.R: this script will generate the count matrices and annotations for the BICCN datasets. The script will create one subdirectory for each dataset and a "joint_annotation" directory to store labels obtained by joint clustering.
 - make_biccn_sce.R: this script converts the previously downloaded data into SingleCellExperiment objects and creates merged versions of the datasets for the protocols. Outputs are:
   - One SingleCellExperiment (SCE) object per dataset (stored in each dataset's subdirectory).
   - full_biccn.rds: merged version of the full dataset (using MetaNeighbor::mergeSCE)
   - biccn_hvgs.txt: highly variable genes extracted from full dataset (using MetaNeighbor::variableGenes).
   - full_biccn_hvg.rds: merged version of the full dataset, restricted to highly variable genes.
   - biccn_gaba.rds: merged version, restricted to GABAergic neurons.
   - WARNING: this script is memory and time consuming (100+ GB for dataset merging, expected run time ~ 1 hour).
 - make_go_sets.R: this script parses mouse Gene Ontology (GO) annotations to create a list of gene sets, which is stored as "go_mouse.rds".
 
The following two scripts generate the multi-modal BICCN dataset. We do not recommend running these, as they are *not* needed in the protocol. The multi-modal data are only used in the Anticipated Results scripts that estimate the impact of batch effects on MetaNeighbor results.
 - download_epigenomics.R: this script downloads the count matrices for the epigenomics datasets from the BICCN (ATAC+methylation).
 - make_epigenomics_sce.R: this script generates SCE objects for the epigenomic datasets and a multi-modal dataset that combines the 7 expression datasets, the ATAC dataset and the methylation dataset.
   
## Make relevant datasets visible to protocols

The protocols assume that the datasets are in the same directory. Before running the protocols, move or copy "full_biccn_hvg.rds", "biccn_gaba.rds" and "go_mouse.rds" to the directory that contains the protocols.

## Dataset naming convention (expression data)

The BICCN dataset names were chosen according to the following convention: single cell (sc) or single nuclei (sn), followed by Chromium 10X version 2 (Cv2), 10X version 3 (Cv3), or SmartSeq (SS). There are two single-nuclei 10X version 3 datasets, one generated by the Zeng lab ("snCv3Z"), the other generated by the Macosko lab ("snCv3M").
